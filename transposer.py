import re

key_signatures_offset = {
    'C': 0,
    'D': 2,
    'E': 4,
    'F': 5,
    'G': 7,
    'A': 9,
    'B': 11,
}

scarlatti_keys = {
   1: 'D minor',
   2: 'G major',
   3: 'A minor',
   4: 'G minor',
   5: 'D minor',
   6: 'F major',
   7: 'A minor',
   8: 'G minor',
   9: 'D minor',
   10: 'D minor',
   11: 'C minor',
   12: 'G minor',
   13: 'G major',
   14: 'G major',
   15: 'E minor',
   16: 'B- major',
   17: 'F major',
   18: 'D minor',
   19: 'F minor',
   20: 'E major',
   21: 'D major',
   22: 'C minor',
   23: 'D major',
   24: 'A major',
   25: 'F+ minor',
   26: 'A major',
   27: 'B minor',
   28: 'E major',
   29: 'D major',
   30: 'G minor',
   31: 'G minor',
   32: 'D minor',
   33: 'D major',
   34: 'D minor',
   35: 'G minor',
   36: 'A minor',
   37: 'C minor',
   38: 'F major',
   39: 'A major',
   40: 'C minor',
   41: 'D minor',
   42: 'B- major',
   43: 'G minor',
   44: 'F major',
   45: 'D major',
   46: 'E major',
   47: 'B- major',
   48: 'C minor',
   49: 'C major',
   50: 'F minor',
   51: 'E- major',
   52: 'D minor',
   53: 'D major',
   54: 'A minor',
   55: 'G major',
   56: 'C minor',
   57: 'B- major',
   58: 'C minor',
   59: 'F major',
   60: 'G minor',
   61: 'A minor',
   62: 'A major',
   63: 'G major',
   64: 'D minor',
   65: 'A major',
   66: 'B- major',
   67: 'F+ minor',
   68: 'E- major',
   69: 'F minor',
   70: 'B- major',
   71: 'G major',
   72: 'C major',
   73: 'C minor',
   74: 'A major',
   75: 'G major',
   76: 'G minor',
   77: 'D minor',
   78: 'F major',
   79: 'G major',
   80: 'G major',
   81: 'E minor',
   82: 'F major',
   83: 'A major',
   84: 'C minor',
   85: 'F major',
   86: 'C major',
   87: 'B minor',
   88: 'G minor',
   89: 'D minor',
   90: 'D minor',
   91: 'G major',
   92: 'D minor',
   93: 'G minor',
   94: 'F major',
   95: 'C major',
   96: 'D major',
   97: 'G minor',
   98: 'E minor',
   99: 'C minor',
   100: 'C major',
   101: 'A major',
   102: 'G minor',
   103: 'G major',
   104: 'G major',
   105: 'G major',
   106: 'F major',
   107: 'F major',
   108: 'G minor',
   109: 'A minor',
   110: 'A minor',
   111: 'G minor',
   112: 'B- major',
   113: 'A major',
   114: 'A major',
   115: 'C minor',
   116: 'C minor',
   117: 'C major',
   118: 'D major',
   119: 'D major',
   120: 'D minor',
   121: 'G minor',
   122: 'D major',
   123: 'E- major',
   124: 'G major',
   125: 'G major',
   126: 'C minor',
   127: 'A- major',
   128: 'B- minor',
   129: 'C minor',
   130: 'A- major',
   131: 'B- minor',
   132: 'C major',
   133: 'C major',
   134: 'E major',
   135: 'E major',
   136: 'E major',
   137: 'D major',
   138: 'D minor',
   139: 'C minor',
   140: 'D major',
   141: 'D minor',
   142: 'F+ minor',
   143: 'C major',
   144: 'G major',
   145: 'D major',
   146: 'G major',
   147: 'E minor',
   148: 'A minor',
   149: 'A minor',
   150: 'F major',
   151: 'F major',
   152: 'G major',
   153: 'G major',
   154: 'B- major',
   155: 'B- major',
   156: 'C major',
   157: 'C major',
   158: 'C minor',
   159: 'C major',
   160: 'D major',
   161: 'D major',
   162: 'E major',
   163: 'E major',
   164: 'D major',
   165: 'C major',
   166: 'C major',
   167: 'F major',
   168: 'F major',
   169: 'G major',
   170: 'C major',
   171: 'G major',
   172: 'B- major',
   173: 'B minor',
   174: 'C minor',
   175: 'A minor',
   176: 'D minor',
   177: 'D major',
   178: 'D major',
   179: 'G minor',
   180: 'G major',
   181: 'A major',
   182: 'A major',
   183: 'F minor',
   184: 'F minor',
   185: 'F minor',
   186: 'F minor',
   187: 'F minor',
   188: 'A minor',
   189: 'B- major',
   190: 'B- major',
   191: 'D minor',
   192: 'E- major',
   193: 'E- major',
   194: 'F major',
   195: 'F major',
   196: 'G minor',
   197: 'B minor',
   198: 'E minor',
   199: 'C major',
   200: 'C major',
   201: 'G major',
   202: 'B- major',
   203: 'E minor',
   204: 'F minor', # 204a
   # 204: 'F minor', # 204b
   205: 'F major',
   206: 'E major',
   207: 'E major',
   208: 'A major',
   209: 'A major',
   210: 'G major',
   211: 'A major',
   212: 'A major',
   213: 'D minor',
   214: 'D major',
   215: 'E major',
   216: 'E major',
   217: 'A minor',
   218: 'A minor',
   219: 'A major',
   220: 'A major',
   221: 'A major',
   222: 'A major',
   223: 'D major',
   224: 'D major',
   225: 'C major',
   226: 'C minor',
   227: 'B minor',
   228: 'B- major',
   229: 'B- major',
   230: 'C minor',
   231: 'C major',
   232: 'E minor',
   233: 'E minor',
   234: 'G minor',
   235: 'G major',
   236: 'D major',
   237: 'D major',
   238: 'F minor',
   239: 'F minor',
   240: 'G major',
   241: 'G major',
   242: 'C major',
   243: 'C major',
   244: 'B major',
   245: 'B major',
   246: 'C+ minor',
   247: 'C+ minor',
   248: 'B- major',
   249: 'B- major',
   250: 'C major',
   251: 'C major',
   252: 'E- major',
   253: 'E- major',
   254: 'C minor',
   255: 'C major',
   256: 'F major',
   257: 'F major',
   258: 'D major',
   259: 'G major',
   260: 'G major',
   261: 'B major',
   262: 'B major',
   263: 'E minor',
   264: 'E major',
   265: 'A minor',
   266: 'B- major',
   267: 'B- major',
   268: 'A major',
   269: 'A major',
   270: 'C major',
   271: 'C major',
   272: 'B- major',
   273: 'B- major',
   274: 'F major',
   275: 'F major',
   276: 'F major',
   277: 'D major',
   278: 'D major',
   279: 'A major',
   280: 'A major',
   281: 'D major',
   282: 'D major',
   283: 'G major',
   284: 'G major',
   285: 'A major',
   286: 'A major',
   287: 'D major',
   288: 'D major',
   289: 'G major',
   290: 'G major',
   291: 'E minor',
   292: 'E minor',
   293: 'B minor',
   294: 'D minor',
   295: 'D minor',
   296: 'F major',
   297: 'F major',
   298: 'D major',
   299: 'D major',
   300: 'A major',
   301: 'A major',
   302: 'C minor',
   303: 'C minor',
   304: 'G major',
   305: 'G major',
   306: 'E- major',
   307: 'E- major',
   308: 'C major',
   309: 'C major',
   310: 'B- major',
   311: 'B- major',
   312: 'D major',
   313: 'D major',
   314: 'G major',
   315: 'G minor',
   316: 'F major',
   317: 'F major',
   318: 'F+ major',
   319: 'F+ major',
   320: 'A major',
   321: 'A major',
   322: 'A major',
   323: 'A major',
   324: 'G major',
   325: 'G major',
   326: 'C major',
   327: 'C major',
   328: 'G major',
   329: 'C major',
   330: 'C major',
   331: 'B- major',
   332: 'B- major',
   333: 'D major',
   334: 'B- major',
   335: 'D major',
   336: 'D major',
   337: 'G major',
   338: 'G major',
   339: 'C major',
   340: 'C major',
   341: 'A minor',
   342: 'A major',
   343: 'A major',
   344: 'A major',
   345: 'D major',
   346: 'D major',
   347: 'G minor',
   348: 'G major',
   349: 'F major',
   350: 'F major',
   351: 'B- major',
   352: 'D major',
   353: 'D major',
   354: 'F major',
   355: 'F major',
   356: 'C major',
   357: 'C major',
   358: 'D major',
   359: 'D major',
   360: 'B- major',
   361: 'B- major',
   362: 'C minor',
   363: 'C minor',
   364: 'F minor',
   365: 'F minor',
   366: 'F major',
   367: 'F major',
   368: 'A major',
   369: 'A major',
   370: 'E- major',
   371: 'E- major',
   372: 'G major',
   373: 'G minor',
   374: 'G major',
   375: 'G major',
   376: 'B minor',
   377: 'B minor',
   378: 'F major',
   379: 'F major',
   380: 'E major',
   381: 'E major',
   382: 'A minor',
   383: 'A minor',
   384: 'C major',
   385: 'C major',
   386: 'F minor',
   387: 'F minor',
   388: 'D major',
   389: 'D major',
   390: 'G major',
   391: 'G major',
   392: 'B- major',
   393: 'B- major',
   394: 'E minor',
   395: 'E major',
   396: 'D minor',
   397: 'D major',
   398: 'C major',
   399: 'C major',
   400: 'D major',
   401: 'D major',
   402: 'E minor',
   403: 'E major',
   404: 'A major',
   405: 'A major',
   406: 'C major',
   407: 'C major',
   408: 'B minor',
   409: 'B minor',
   410: 'B- major',
   411: 'B- major',
   412: 'G major',
   413: 'G major',
   414: 'D major',
   415: 'D major',
   416: 'D major',
   417: 'D minor',
   418: 'F major',
   419: 'F major',
   420: 'C major',
   421: 'C major',
   422: 'C major',
   423: 'C major',
   424: 'G major',
   425: 'G major',
   426: 'G minor',
   427: 'G major',
   428: 'A major',
   429: 'A major',
   430: 'D major',
   431: 'G major',
   432: 'G major',
   433: 'G major',
   434: 'D minor',
   435: 'D major',
   436: 'D major',
   437: 'F major',
   438: 'F major',
   439: 'B- major',
   440: 'B- major',
   441: 'B- major',
   442: 'B- major',
   443: 'D major',
   444: 'D minor',
   445: 'F major',
   446: 'F major',
   447: 'F+ minor',
   448: 'F+ minor',
   449: 'G major',
   450: 'G minor',
   451: 'A minor',
   452: 'A major',
   453: 'A major',
   454: 'G major',
   455: 'G major',
   456: 'A major',
   457: 'A major',
   458: 'D major',
   459: 'D minor',
   460: 'C major',
   461: 'C major',
   462: 'F minor',
   463: 'F minor',
   464: 'C major',
   465: 'C major',
   466: 'F minor',
   467: 'F minor',
   468: 'F major',
   469: 'F major',
   470: 'G major',
   471: 'G major',
   472: 'B- major',
   473: 'B- major',
   474: 'E- major',
   475: 'E- major',
   476: 'G minor',
   477: 'G major',
   478: 'D major',
   479: 'D major',
   480: 'D major',
   481: 'F minor',
   482: 'F major',
   483: 'F major',
   484: 'D major',
   485: 'C major',
   486: 'C major',
   487: 'C major',
   488: 'B- major',
   489: 'B- major',
   490: 'D major',
   491: 'D major',
   492: 'D major',
   493: 'G major',
   494: 'G major',
   495: 'E major',
   496: 'E major',
   497: 'B minor',
   498: 'B minor',
   499: 'A major',
   500: 'A major',
   501: 'C major',
   502: 'C major',
   503: 'B- major',
   504: 'B- major',
   505: 'F major',
   506: 'F major',
   507: 'E- major',
   508: 'E- major',
   509: 'D major',
   510: 'D minor',
   511: 'D major',
   512: 'D major',
   513: 'C major',
   514: 'C major',
   515: 'C major',
   516: 'D minor',
   517: 'D minor',
   518: 'F major',
   519: 'F minor',
   520: 'G major',
   521: 'G major',
   522: 'G major',
   523: 'G major',
   524: 'F major',
   525: 'F major',
   526: 'C minor',
   527: 'C major',
   528: 'B- major',
   529: 'B- major',
   530: 'E major',
   531: 'E major',
   532: 'A minor',
   533: 'A major',
   534: 'D major',
   535: 'D major',
   536: 'A major',
   537: 'A major',
   538: 'G major',
   539: 'G major',
   540: 'F major',
   541: 'F major',
   542: 'F major',
   543: 'F major',
   544: 'B- major',
   545: 'B- major',
   546: 'G minor',
   547: 'G major',
   548: 'C major',
   549: 'C major',
   550: 'B- major',
   551: 'B- major',
   552: 'D minor',
   553: 'D minor',
   554: 'F major',
   555: 'F minor',
}


def get_offset(key: str) -> int:
    offset = key_signatures_offset[key[0]] + (1 if key[1] == '+' else 0) + (-1 if key[1] == '-' else 0)

    if offset > 6:
        offset = 12 - offset

    return offset


def scarlatti_get_offset(filename: str):
    k_num = re.match(r'sonatas_k-([0-9][0-9][0-9])_\(c\)sankey\.mid', filename)[1]
    key = scarlatti_keys[int(k_num)]
    return get_offset(key)
